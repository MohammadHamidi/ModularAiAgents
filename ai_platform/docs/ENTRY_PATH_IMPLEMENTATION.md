# ูพุงุฏูโุณุงุฒ: ุขฺฏุงู ุงุฌูุช ุงุฒ ูุจุฏุง ูุฑูุฏ ฺฉุงุฑุจุฑ (Entry Path Context)

## ุฎูุงุตู ุชุบุฑุงุช

ุงุฌูุชโูุง ุงฺฉููู ูโุฏุงููุฏ ฺฉุงุฑุจุฑ ุงุฒ ฺฉุฏุงู ุตูุญู ุณุงุช ฺุช ุฑุง ุจุงุฒ ฺฉุฑุฏู ุงุณุช. ุงู ุจุงุนุซ ูโุดูุฏ ููุช ฺฉุงุฑุจุฑ ูโฺฏูุฏ ยซููู ฺฉูุดยป ุง ยซุงู ุตูุญูยปุ ุงุฌูุช ุจุชูุงูุฏ ุจู ุฏุฑุณุช ูุชูุฌู ุดูุฏ.

---

## ุชุบุฑุงุช ุงูุฌุงู ุดุฏู

### ฑ. ุฐุฎุฑู Path ุฏุฑ chat/init

**ูุงู**: `services/chat-service/main.py`

```python
# Step 5.5: Save entry_path (where user came from) to context
normalized_user_data["entry_path"] = {"value": path}
```

- ุจุนุฏ ุงุฒ ุฑูุฒฺฏุดุง `encrypted_param`ุ ููุฏุงุฑ `Path` ุฏุฑ `entry_path` ุฐุฎุฑู ูโุดูุฏ
- ุงู ููุฏุงุฑ ุฏุฑ session context ุฐุฎุฑู ูโุดูุฏ ู ุฏุฑ ุชูุงู ฺฏูุชฺฏููุง ุจุนุฏ ุฏุฑ ุฏุณุชุฑุณ ุงุณุช

### ฒ. Helper ุจุฑุง ุชูุถุญุงุช ูุงุฑุณ Path

**ูุงู ุฌุฏุฏ**: `shared/path_context_helper.py`

- `get_path_description(path)`: ุชุจุฏู path ุจู ุชูุถุญ ูุงุฑุณ
- `format_entry_path_context(path)`: ูุฑูุช ฺฉุฑุฏู path ุจู ุนููุงู context ุจุฑุง ูพุฑุงููพุช
- ุงุฒ `path_agent_mapping.yaml` ู `website_routes.yaml` ุจุฑุง ุชูุถุญุงุช ุงุณุชูุงุฏู ูโฺฉูุฏ

**ูุซุงูโูุง**:
- `/action-list` โ "ูุณุช ฺฉูุดโูุง"
- `/my-profile/saved-actions` โ "ฺฉูุดโูุง ุฐุฎุฑูโุดุฏู"
- `/actions/report-form` โ "ูุฑู ุซุจุช ฺฏุฒุงุฑุด"

### ณ. ุงูุฒูุฏู Entry Path ุจู ูพุฑุงููพุช

**ูุงู**: `shared/prompt_builder.py`

```python
# Entry path context - where user came from
if user_info:
    entry_path_data = user_info.get("entry_path")
    if entry_path_data:
        entry_path = entry_path_data.get("value")
        if entry_path:
            entry_ctx = format_entry_path_context(entry_path)
            if entry_ctx:
                parts.append(entry_ctx)
```

- ุฏุฑ `build_system_prompt()`ุ ุงฺฏุฑ `entry_path` ุฏุฑ `user_info` ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏุ ุจู ูพุฑุงููพุช ุงุถุงูู ูโุดูุฏ
- ูุฑูุช: "๐ ฺฉุงุฑุจุฑ ฺุช ุฑุง ุงุฒ ุตูุญู ยซ...ยป ุจุงุฒ ฺฉุฑุฏู ุงุณุช. ุงู ุนู..."

---

## ุฌุฑุงู ฺฉุงูู

### ฑ. ูุจโุณุงุช ุณูุฑุงู

```html
<iframe src="https://safrainai.pish.run/ui?encrypted_param=ENCRYPTED_VALUE">
```

- `encrypted_param` ุดุงูู: `{ "UserId": "...", "Path": "konesh/list/" }`

### ฒ. Chat.html

- `encrypted_param` ุฑุง ูโุฎูุงูุฏ
- `POST /chat/init` ุจุง `{ encrypted_param: "..." }` ูุฑุงุฎูุงู ูโฺฉูุฏ

### ณ. chat/init

1. ุฑูุฒฺฏุดุง โ `UserId`, `Path`
2. ุฏุฑุงูุช `user_data` ุงุฒ API
3. ุงูุชุฎุงุจ agent ุจุฑ ุงุณุงุณ Path
4. **ุฐุฎุฑู `entry_path` ุฏุฑ context** โ **ุฌุฏุฏ**
5. ุจุฑฺฏุฑุฏุงูุฏู `session_id`, `agent_key`, ...

### ด. ฺุช (ุงุฑุณุงู ูพุงู)

1. ุจุงุฑฺฏุฐุงุฑ `shared_context` ุงุฒ database
2. **`entry_path` ุฏุฑ `shared_context` ููุฌูุฏ ุงุณุช** โ **ุฌุฏุฏ**
3. ุณุงุฎุช ูพุฑุงููพุช ุจุง `build_system_prompt()`
4. **ูพุฑุงููพุช ุดุงูู context ูุจุฏุง ูุฑูุฏ ุงุณุช** โ **ุฌุฏุฏ**

### ต. ุงุฌูุช

- ูโุฏุงูุฏ ฺฉุงุฑุจุฑ ุงุฒ ฺฉุฏุงู ุตูุญู ุขูุฏู
- ูโุชูุงูุฏ ุจู ุฏุฑุณุช ุจู ยซููู ฺฉูุดยปุ ยซุงู ุตูุญูยป ูพุงุณุฎ ุฏูุฏ

---

## ูุซุงู Context ุฏุฑ ูพุฑุงููพุช

```
๐ ฺฉุงุฑุจุฑ ฺุช ุฑุง ุงุฒ ุตูุญู ยซูุณุช ฺฉูุดโูุงยป (/action-list) ุจุงุฒ ฺฉุฑุฏู ุงุณุช.
ุงู ุนู ฺฉุงุฑุจุฑ ุงุญุชูุงูุงู ุฏุฑ ุญุงู ุฏุฏู ุงู ุตูุญู ุงุณุช ู ููฺฉู ุงุณุช ุจู ูุญุชูุง ุงู ุตูุญู ุงุดุงุฑู ฺฉูุฏ (ูุซูุงู ยซููู ฺฉูุดยปุ ยซุงู ุตูุญูยปุ ยซุงูุฌุงยป).
ููุช ฺฉุงุฑุจุฑ ูโฺฏูุฏ ยซูููยป ุง ยซุงูยปุ ููุธูุฑ ุงู ุงุญุชูุงูุงู ูุญุชูุง ููู ุตูุญู ุงุณุช.
```

---

## ุชุณุช

### ุชุณุช Helper

```python
from shared.path_context_helper import get_path_description, format_entry_path_context

get_path_description("/action-list")
# โ "ูุณุช ฺฉูุดโูุง"

format_entry_path_context("/action-list")
# โ "๐ ฺฉุงุฑุจุฑ ฺุช ุฑุง ุงุฒ ุตูุญู ยซูุณุช ฺฉูุดโูุงยป (/action-list) ุจุงุฒ ฺฉุฑุฏู ุงุณุช..."
```

### ุชุณุช ฺฉุงูู

1. ุจุงุฒ ฺฉุฑุฏู ฺุช ุงุฒ ุตูุญู `/action-list` ุจุง `encrypted_param`
2. ุงุฑุณุงู ูพุงู: "ููู ฺฉูุด"
3. ุงุฌูุช ุจุงุฏ ุจุฏุงูุฏ ููุธูุฑ ฺฉุงุฑุจุฑ ุงุฒ ยซูููยป ฺุณุช

---

## ูุงูโูุง ุชุบุฑ ุงูุชู

1. โ `services/chat-service/main.py` - ุฐุฎุฑู entry_path
2. โ `shared/prompt_builder.py` - ุงูุฒูุฏู entry_path ุจู ูพุฑุงููพุช
3. โ `shared/path_context_helper.py` - **ูุงู ุฌุฏุฏ** ุจุฑุง helper functions

---

## ูุชุฌู

ุงุฌูุชโูุง ุงฺฉููู:
- โ ูโุฏุงููุฏ ฺฉุงุฑุจุฑ ุงุฒ ฺฉุฏุงู ุตูุญู ุขูุฏู
- โ ูโุชูุงููุฏ ุจู ยซูููยปุ ยซุงูยปุ ยซุงูุฌุงยป ูพุงุณุฎ ุตุญุญ ุจุฏููุฏ
- โ context-aware ูุณุชูุฏ ู ูโููููุฏ ฺฉุงุฑุจุฑ ุฏุฑ ุญุงู ุฏุฏู ฺู ุตูุญูโุง ุงุณุช
